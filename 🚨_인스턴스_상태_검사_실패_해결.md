# 🚨 인스턴스 연결성 검사 실패 해결 가이드

## 문제 증상
```
❌ 인스턴스 연결성 검사 실패
❌ 인스턴스가 연결성 검사를 통과하지 못함
⏰ 2025/10/25 17:16 GMT+9 (약 7시간 전)
```

---

## ✅ 해결 방법 (순서대로 시도)

### 방법 1: 인스턴스 재부팅 (추천! 1분)

**가장 빠르고 안전한 방법입니다!**

1. AWS EC2 콘솔에서 인스턴스 선택
2. 상단 **"인스턴스 상태"** 클릭
3. **"인스턴스 재부팅"** 선택
4. **"재부팅"** 확인
5. 2-3분 대기

**결과 확인:**
```powershell
Test-NetConnection -ComputerName 3.27.28.175 -Port 80
```

---

### 방법 2: 인스턴스 중지 → 시작 (3분)

재부팅으로 안 되면 시도:

1. 인스턴스 선택
2. **"인스턴스 상태"** → **"인스턴스 중지"**
3. 상태가 **"중지됨"**이 될 때까지 대기 (1-2분)
4. **"인스턴스 상태"** → **"인스턴스 시작"**
5. 상태가 **"실행 중"**이 될 때까지 대기 (1-2분)

**주의:** IP 주소가 변경될 수 있습니다!

---

### 방법 3: 인스턴스 상태 확인

현재 인스턴스 상태 확인:

1. EC2 대시보드 → **인스턴스**
2. 인스턴스 선택
3. 하단 **"상태 검사"** 탭 확인

**상태 검사 종류:**
- ✅ 시스템 상태 검사: AWS 인프라 문제
- ❌ 인스턴스 상태 검사: 인스턴스 자체 문제

---

### 방법 4: 보안 그룹 확인

포트가 막혀있을 수 있습니다:

1. 인스턴스 선택
2. 하단 **"보안"** 탭
3. **보안 그룹** 클릭
4. **인바운드 규칙** 확인

**필요한 규칙:**
```
✅ SSH     | TCP | 22   | 0.0.0.0/0
✅ HTTP    | TCP | 80   | 0.0.0.0/0
✅ HTTPS   | TCP | 443  | 0.0.0.0/0
✅ Custom  | TCP | 8000 | 0.0.0.0/0
```

---

### 방법 5: 시스템 로그 확인

문제 원인 파악:

1. 인스턴스 선택
2. **작업** → **모니터링 및 문제 해결** → **시스템 로그 가져오기**
3. 에러 메시지 확인

**일반적인 문제:**
- 디스크 풀 (Disk Full)
- 메모리 부족 (Out of Memory)
- 커널 패닉 (Kernel Panic)

---

### 방법 6: 인스턴스 복구 (최후의 수단)

위 방법이 모두 실패하면:

1. 인스턴스 선택
2. **작업** → **모니터링 및 문제 해결** → **EC2 인스턴스 복구**
3. 지침 따라 복구

**주의:** 데이터 손실 가능성 있음!

---

## 🎯 빠른 해결 (지금 바로!)

### 1단계: 재부팅

AWS 콘솔에서:
```
인스턴스 선택
→ 인스턴스 상태
→ 인스턴스 재부팅
→ 재부팅 확인
```

### 2단계: 3분 대기

### 3단계: 확인

PowerShell에서:
```powershell
Test-NetConnection -ComputerName 3.27.28.175 -Port 80
```

**True가 나오면 성공!**

---

## 📊 문제 원인 (참고)

### 일반적인 원인:

1. **디스크 공간 부족**
   - 로그 파일이 너무 큼
   - 빌드 파일이 쌓임

2. **메모리 부족**
   - 서비스가 너무 많음
   - 메모리 누수

3. **네트워크 문제**
   - 방화벽 설정
   - 라우팅 문제

4. **서비스 크래시**
   - Gunicorn 다운
   - PM2 다운
   - Nginx 다운

---

## 🔄 재부팅 후 할 일

서비스가 자동으로 시작되지 않을 수 있습니다:

### Session Manager로 접속:

1. 인스턴스 선택
2. **연결** → **Session Manager**
3. 다음 명령어 실행:

```bash
# 서비스 상태 확인
sudo systemctl status gunicorn
pm2 status
sudo systemctl status nginx

# 서비스 시작 (필요시)
sudo systemctl start gunicorn
pm2 start gym-web
sudo systemctl start nginx

# 배포 (필요시)
cd ~/pumpy
git pull
cd gym_api
source venv/bin/activate
python manage.py migrate
sudo systemctl restart gunicorn

cd ../gym_web
npm install
npm run build
pm2 restart gym-web

sudo systemctl restart nginx
```

---

## ✅ 완료 확인

### 1. 웹 브라우저:
```
http://3.27.28.175
```

### 2. PowerShell:
```powershell
Test-NetConnection -ComputerName 3.27.28.175 -Port 80
```

### 3. APK:
- 앱 재실행
- 정상 작동 확인!

---

## 💡 예방 조치

### 디스크 공간 모니터링:
```bash
df -h
```

### 메모리 모니터링:
```bash
free -h
```

### 로그 정리 (주기적):
```bash
sudo journalctl --vacuum-time=7d
sudo find /var/log -type f -name "*.log" -mtime +7 -delete
```

---

## 📞 추가 도움

문제가 계속되면:
- AWS Support 티켓 생성
- EC2 인스턴스 타입 업그레이드 고려
- 새 인스턴스 생성 고려

---

**작성:** 2025-10-25
**문제:** 인스턴스 연결성 검사 실패
**해결:** 인스턴스 재부팅 (1분!)

