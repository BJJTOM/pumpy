# ğŸš¨ 502 Bad Gateway ì—ëŸ¬ í•´ê²°

## ë¬¸ì œ: Nginxê°€ ë°±ì—”ë“œì™€ í†µì‹  ë¶ˆê°€

502 ì—ëŸ¬ëŠ” ë‹¤ìŒ ì¤‘ í•˜ë‚˜ê°€ ë¬¸ì œì…ë‹ˆë‹¤:
1. Gunicornì´ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
2. PM2 (Next.js)ê°€ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
3. í¬íŠ¸ ì„¤ì • ë¬¸ì œ

---

## âœ… ë¹ ë¥¸ í•´ê²° (Session Managerì—ì„œ)

### 1ë‹¨ê³„: ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸

```bash
# Gunicorn ìƒíƒœ
sudo systemctl status gunicorn --no-pager

# PM2 ìƒíƒœ
pm2 status

# Nginx ìƒíƒœ
sudo systemctl status nginx --no-pager
```

---

### 2ë‹¨ê³„: ë¬¸ì œ í•´ê²°

#### A. Gunicorn ë¬¸ì œ

```bash
# Gunicorn ë¡œê·¸ í™•ì¸
sudo journalctl -u gunicorn -n 50 --no-pager

# Gunicorn ì¬ì‹œì‘
cd ~/pumpy/gym_api
source venv/bin/activate
sudo systemctl restart gunicorn

# ìƒíƒœ í™•ì¸
sudo systemctl status gunicorn
```

#### B. PM2 (Next.js) ë¬¸ì œ

```bash
# PM2 ë¡œê·¸ í™•ì¸
pm2 logs gym-web --lines 50 --nostream

# PM2 ì™„ì „ ì¬ì‹œì‘
pm2 delete gym-web
cd ~/pumpy/gym_web
pm2 start npm --name gym-web -- start
pm2 save

# ìƒíƒœ í™•ì¸
pm2 status
```

#### C. Next.js ë¹Œë“œ ì‹¤íŒ¨

```bash
# ë¹Œë“œ ì¬ì‹œë„
cd ~/pumpy/gym_web
rm -rf .next node_modules/.cache
npm install
npm run build

# PM2 ì¬ì‹œì‘
pm2 delete gym-web
pm2 start npm --name gym-web -- start
pm2 save
```

---

### 3ë‹¨ê³„: í¬íŠ¸ í™•ì¸

```bash
# 8000ë²ˆ í¬íŠ¸ (Gunicorn) í™•ì¸
sudo netstat -tlnp | grep 8000

# 3000ë²ˆ í¬íŠ¸ (Next.js) í™•ì¸
sudo netstat -tlnp | grep 3000

# 80ë²ˆ í¬íŠ¸ (Nginx) í™•ì¸
sudo netstat -tlnp | grep 80
```

---

### 4ë‹¨ê³„: Nginx ì¬ì‹œì‘

```bash
# Nginx ì„¤ì • í…ŒìŠ¤íŠ¸
sudo nginx -t

# Nginx ì¬ì‹œì‘
sudo systemctl restart nginx

# ìƒíƒœ í™•ì¸
sudo systemctl status nginx
```

---

## ğŸ¯ ì™„ì „ ì¬ë°°í¬ (ëª¨ë“  ê²ƒì´ ì‹¤íŒ¨í•˜ë©´)

```bash
# 1. ëª¨ë“  ì„œë¹„ìŠ¤ ì¤‘ì§€
pm2 delete gym-web
sudo systemctl stop gunicorn
sudo systemctl stop nginx

# 2. ì½”ë“œ ì—…ë°ì´íŠ¸
cd ~/pumpy
git pull origin main

# 3. ë°±ì—”ë“œ ì¬ì‹œì‘
cd gym_api
source venv/bin/activate
pip install -r requirements.txt
python manage.py migrate
python manage.py collectstatic --noinput
sudo systemctl start gunicorn
sudo systemctl status gunicorn

# 4. í”„ë¡ íŠ¸ì—”ë“œ ì¬ë¹Œë“œ
cd ../gym_web
npm install
rm -rf .next
npm run build
pm2 start npm --name gym-web -- start
pm2 save
pm2 status

# 5. Nginx ì‹œì‘
sudo systemctl start nginx
sudo systemctl status nginx
```

---

## ğŸ” ë¡œê·¸ í™•ì¸ ëª…ë ¹ì–´

```bash
# Gunicorn ì‹¤ì‹œê°„ ë¡œê·¸
sudo journalctl -u gunicorn -f

# PM2 ì‹¤ì‹œê°„ ë¡œê·¸
pm2 logs gym-web

# Nginx ì—ëŸ¬ ë¡œê·¸
sudo tail -f /var/log/nginx/error.log

# Nginx ì•¡ì„¸ìŠ¤ ë¡œê·¸
sudo tail -f /var/log/nginx/access.log
```

---

## ğŸ’¡ ì¼ë°˜ì ì¸ ì›ì¸

### 1. Next.js ë¹Œë“œ ì‹¤íŒ¨
```bash
cd ~/pumpy/gym_web
npm run build
# ë¹Œë“œ ì—ëŸ¬ í™•ì¸
```

### 2. í¬íŠ¸ ì¶©ëŒ
```bash
# 3000ë²ˆ í¬íŠ¸ í”„ë¡œì„¸ìŠ¤ í™•ì¸
sudo lsof -i :3000
# í•„ìš”ì‹œ ì¢…ë£Œ
sudo kill -9 [PID]
```

### 3. ë©”ëª¨ë¦¬ ë¶€ì¡±
```bash
free -h
# ë©”ëª¨ë¦¬ê°€ ë¶€ì¡±í•˜ë©´ swap ì¶”ê°€ ë˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ ì—…ê·¸ë ˆì´ë“œ
```

---

## âœ… í•´ê²° í™•ì¸

```bash
# ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ
http://3.27.28.175

# ë˜ëŠ” curlë¡œ í…ŒìŠ¤íŠ¸
curl -I http://localhost:3000
curl -I http://localhost:8000
curl -I http://3.27.28.175
```

---

ì‘ì„±: 2025-10-25
ë¬¸ì œ: 502 Bad Gateway
ì£¼ìš” ì›ì¸: Gunicorn ë˜ëŠ” PM2 ì„œë¹„ìŠ¤ ë¯¸ì‹¤í–‰

