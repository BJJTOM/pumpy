# 🚨 서버 다운 - 긴급 복구 가이드

## 🔴 현재 상황
- **HTTP 응답:** ❌ 없음
- **핑:** ❌ 100% 실패
- **SSH:** ❌ 연결 불가
- **원인:** Next.js 빌드가 메모리 초과로 서버 크래시

---

## ⚡ 즉시 해결 방법

### 1단계: AWS 콘솔에서 인스턴스 재부팅

1. **AWS 콘솔 접속**
   - https://console.aws.amazon.com/ec2

2. **인스턴스 선택**
   - EC2 → 인스턴스 → `i-0e5a3a1a3e2a9a1a3` 선택

3. **인스턴스 재부팅**
   - 우클릭 → **인스턴스 상태** → **인스턴스 재부팅**
   - 또는 상단 **인스턴스 상태** 버튼 → **재부팅**

4. **대기**
   - 약 1-2분 대기

5. **상태 확인**
   - 인스턴스 상태가 "실행 중"으로 변경되면 OK

---

## 🔧 재부팅 후 조치

### 방법 1: 로컬에서 빌드 후 업로드 (추천!)

Next.js를 AWS 서버에서 빌드하면 메모리 부족으로 계속 크래시될 것입니다.
**로컬에서 빌드하고 업로드하는 것이 안전합니다!**

#### 로컬 빌드 명령어:
```powershell
cd C:\Users\guddn\Downloads\COCO\gym_web
npm run build
```

#### 빌드된 파일 업로드:
```powershell
cd C:\Users\guddn\Downloads\COCO

# .next 폴더를 압축
tar -czf next-build.tar.gz -C gym_web .next

# AWS로 업로드
scp -i "pumpy-key.pem" next-build.tar.gz ubuntu@3.27.28.175:~/

# SSH로 접속하여 압축 해제
ssh -i "pumpy-key.pem" ubuntu@3.27.28.175 "cd ~/pumpy/gym_web && tar -xzf ~/next-build.tar.gz && pm2 restart gym-web && sudo systemctl restart nginx"
```

---

### 방법 2: AWS에서 메모리 최적화 빌드

만약 AWS에서 빌드해야 한다면, 메모리를 늘려야 합니다:

#### Swap 메모리 추가:
```bash
ssh -i "pumpy-key.pem" ubuntu@3.27.28.175

# Swap 메모리 생성 (2GB)
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

# 영구 설정
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab

# Swap 확인
free -h
```

#### 메모리 제한 빌드:
```bash
cd ~/pumpy/gym_web
export NODE_OPTIONS='--max-old-space-size=1024'
pm2 stop gym-web
rm -rf .next
npm run build
pm2 start npm --name gym-web -- start
pm2 save
sudo systemctl restart nginx
```

---

## 📊 현재 추천 방법

**🎯 로컬 빌드 + 업로드 (방법 1)이 가장 안전합니다!**

이유:
- AWS 서버 메모리 부족 (1GB RAM)
- Next.js 빌드는 2-4GB 메모리 필요
- 빌드 중 서버 크래시 위험

---

## ⏱️ 예상 시간
- **인스턴스 재부팅:** 1-2분
- **로컬 빌드:** 5-7분
- **업로드 및 배포:** 1-2분
- **총 시간:** 약 10분

---

## 🎯 다음 단계

1. ✅ AWS 콘솔에서 인스턴스 재부팅
2. ⏳ 재부팅 완료 대기 (1-2분)
3. ⏳ 로컬에서 Next.js 빌드
4. ⏳ 빌드 파일 AWS에 업로드
5. ⏳ PM2 재시작
6. ✅ 배포 완료!

---

**지금 바로 AWS 콘솔에서 인스턴스를 재부팅해 주세요!**

