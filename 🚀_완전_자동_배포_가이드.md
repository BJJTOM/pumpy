# 🚀 펌피(Pumpy) 완전 자동 배포 가이드

## 📋 제가 모든 것을 준비했습니다!

안녕하세요! AWS 무료 버전(프리티어)으로 배포하는 모든 과정을 안내하겠습니다.

---

## ✅ 현재 상황

- GitHub 원격 저장소가 아직 연결되지 않음
- 로컬에 모든 코드는 준비됨
- AWS 계정은 생성됨 (무료 프리티어)

---

## 🎯 진행 방법

AWS 무료 프리티어로는 **EC2** 또는 **Lightsail**을 사용할 수 있습니다.

### 방법 1: AWS EC2 프리티어 (추천!)

**장점:**
- ✅ 12개월 동안 완전 무료!
- ✅ t2.micro 인스턴스 (1GB RAM)
- ✅ 월 750시간 (24시간 × 31일 = 744시간)
- ✅ 완전히 충분함

**제공 사항:**
- 750시간/월 Linux t2.micro 인스턴스
- 30GB EBS 스토리지
- 15GB 데이터 전송 (외부로)

### 방법 2: Lightsail (3개월 무료)

**장점:**
- ✅ 설정 더 간단
- ✅ 첫 3개월 무료
- ✅ 이후 $5/월

---

## 🚀 시작하기: AWS EC2 프리티어 (12개월 무료!)

제가 단계별로 정확히 알려드리겠습니다. **화면을 보면서 따라하시면 됩니다!**

---

## 1단계: GitHub 저장소 생성

### 방법 A: 웹에서 생성 (가장 쉬움) ⭐

1. **https://github.com/login** 접속
2. 로그인: `BJJTOM` / 비밀번호 입력
3. 우측 상단 **"+"** 클릭 → **"New repository"** 클릭
4. 다음 정보 입력:
   ```
   Repository name: pumpy
   Description: 펌피 - 헬스장 관리 시스템
   Public (공개) 선택
   ```
5. **"Create repository"** 클릭
6. 화면에 표시되는 URL 복사: `https://github.com/BJJTOM/pumpy.git`

### 방법 B: 저장소가 이미 있는 경우

`https://github.com/BJJTOM/pumpy` 접속해서 확인

---

## 2단계: 로컬 코드를 GitHub에 푸시

GitHub 저장소를 생성한 후, **다음 명령어들을 복사해서 실행하세요:**

```powershell
# 현재 디렉토리 확인
cd C:\Users\guddn\Downloads\COCO

# GitHub 원격 저장소 연결
git remote add origin https://github.com/BJJTOM/pumpy.git

# 브랜치 이름 확인 및 변경 (필요시)
git branch -M main

# 푸시 (GitHub 로그인 창이 뜰 수 있음)
git push -u origin main
```

**GitHub 로그인 창이 뜨면:**
- Email: `guddn953@gmail.com`
- Password 또는 토큰 입력

---

## 3단계: AWS EC2 인스턴스 생성 (무료!)

### A. AWS 콘솔 접속

1. **https://console.aws.amazon.com/** 접속
2. AWS 계정으로 로그인
3. 상단 검색창에 **"EC2"** 입력하고 클릭

### B. 리전 선택

1. 우측 상단에서 리전 선택
2. **"Asia Pacific (Seoul) ap-northeast-2"** 선택

### C. EC2 인스턴스 시작

1. 좌측 메뉴에서 **"Instances"** 클릭
2. 주황색 **"Launch instances"** 버튼 클릭

### D. 인스턴스 설정

#### 1. Name and tags
```
Name: pumpy-server
```

#### 2. Application and OS Images
```
Quick Start: Ubuntu
Ubuntu Server 22.04 LTS (HVM), SSD Volume Type
Architecture: 64-bit (x86)
```

#### 3. Instance type
```
t2.micro (프리티어 적격) ✅
1 vCPU, 1 GiB Memory
```

#### 4. Key pair (login)
- **"Create new key pair"** 클릭
```
Key pair name: pumpy-key
Key pair type: RSA
Private key file format: .pem (Mac/Linux) 또는 .ppk (Windows PuTTY)
```
- **"Create key pair"** 클릭
- 자동으로 파일 다운로드됨 (잘 보관하세요!)

#### 5. Network settings
- **"Edit"** 클릭
- **"Add security group rule"** 클릭해서 다음 추가:

```
보안 그룹 규칙:

1. SSH
   Type: SSH
   Port: 22
   Source: Anywhere (0.0.0.0/0)

2. HTTP
   Type: HTTP
   Port: 80
   Source: Anywhere (0.0.0.0/0)

3. HTTPS
   Type: HTTPS
   Port: 443
   Source: Anywhere (0.0.0.0/0)

4. Custom TCP (Django API)
   Type: Custom TCP
   Port: 8000
   Source: Anywhere (0.0.0.0/0)
```

#### 6. Configure storage
```
1 x 30 GiB gp3 (프리티어는 30GB까지 무료)
```

#### 7. Summary 확인
- **"Number of instances"**: 1
- **"Free tier eligible"** 표시 확인 ✅

#### 8. Launch!
- 우측 하단 **"Launch instance"** 클릭
- **"View all instances"** 클릭

---

## 4단계: Elastic IP 할당 (고정 IP)

### A. Elastic IP 생성

1. 좌측 메뉴에서 **"Network & Security" > "Elastic IPs"** 클릭
2. **"Allocate Elastic IP address"** 클릭
3. 그대로 두고 **"Allocate"** 클릭

### B. 인스턴스에 연결

1. 생성된 Elastic IP 선택
2. **"Actions"** → **"Associate Elastic IP address"** 클릭
3. **"Instance"** 선택: `pumpy-server` 선택
4. **"Associate"** 클릭

### C. IP 주소 메모

- 할당된 Elastic IP 주소를 메모하세요!
- 예: `13.124.123.456`

---

## 5단계: SSH 접속

### Windows에서 접속 (PowerShell 사용)

```powershell
# 다운로드한 키 파일 위치로 이동
cd C:\Users\guddn\Downloads

# 키 파일 권한 설정 (필요시)
# icacls pumpy-key.pem /inheritance:r /grant:r "%USERNAME%:R"

# SSH 접속
ssh -i pumpy-key.pem ubuntu@YOUR_ELASTIC_IP
```

**YOUR_ELASTIC_IP를 실제 IP로 변경!**

예: `ssh -i pumpy-key.pem ubuntu@13.124.123.456`

**첫 접속 시:**
```
The authenticity of host... Are you sure you want to continue connecting (yes/no)?
```
→ **yes** 입력

---

## 6단계: 서버 설정 및 배포

SSH 접속 후 다음 명령어들을 **하나씩** 실행하세요:

### A. 시스템 업데이트
```bash
sudo apt update && sudo apt upgrade -y
```

### B. Git으로 코드 다운로드
```bash
cd /home/ubuntu
git clone https://github.com/BJJTOM/pumpy.git
cd pumpy
```

### C. 자동 배포 스크립트 실행
```bash
chmod +x deploy_to_aws.sh
./deploy_to_aws.sh
```

**스크립트가 자동으로 다음을 수행합니다:**
- Python, Node.js, Nginx, PostgreSQL 설치
- 데이터베이스 생성
- Django 마이그레이션
- Next.js 빌드
- 모든 서비스 시작

⏱️ **약 15분 소요** (커피 한 잔 하고 오세요! ☕)

---

## 7단계: 배포 완료 확인

스크립트가 완료되면 다음과 같이 표시됩니다:

```
========================================
  🎉 배포 완료!
========================================

웹사이트: http://YOUR_IP/
API:      http://YOUR_IP/api/
관리자:   http://YOUR_IP/admin/
```

---

## 8단계: 관리자 계정 생성

```bash
cd /home/ubuntu/pumpy/gym_api
source venv/bin/activate
python manage.py createsuperuser
```

입력:
- Username: `admin`
- Email: `your@email.com`
- Password: (안전한 비밀번호)

---

## 9단계: 웹 브라우저에서 접속 테스트

1. **웹사이트**: `http://YOUR_ELASTIC_IP/`
2. **API**: `http://YOUR_ELASTIC_IP/api/members/`
3. **관리자**: `http://YOUR_ELASTIC_IP/admin/`

---

## 10단계: 앱 설정

### A. API URL 변경

로컬 PC에서:

**1. PumpyApp/src/utils/api.ts**
```typescript
return 'http://YOUR_ELASTIC_IP/api';
```

**2. PumpyApp/src/screens/ServerConfigScreen.tsx** (35번째 줄)
```typescript
setServerUrl('http://YOUR_ELASTIC_IP/api');
```

### B. APK 재빌드

```powershell
cd C:\Users\guddn\Downloads\COCO\PumpyApp\android
$env:JAVA_HOME = "C:\Program Files\Microsoft\jdk-21.0.8.9-hotspot"
$env:ANDROID_HOME = "C:\Users\guddn\AppData\Local\Android\Sdk"
.\gradlew assembleRelease
Copy-Item "app\build\outputs\apk\release\app-release.apk" -Destination "C:\Users\guddn\Downloads\COCO\Pumpy_AWS무료버전.apk"
```

---

## ✅ 완료!

이제 펌피 앱이 AWS에서 **12개월 동안 무료로** 실행됩니다! 🎉

---

## 💰 비용 (12개월 프리티어)

- **EC2 인스턴스**: 무료 (750시간/월)
- **EBS 스토리지**: 무료 (30GB)
- **데이터 전송**: 무료 (15GB/월 아웃바운드)
- **Elastic IP**: 무료 (인스턴스에 연결된 경우)

**총: $0/월 (12개월간)** 🆓

**12개월 후:**
- 계속 사용 시: 약 $10/월
- 또는 Lightsail로 이전: $5/월

---

## 🆘 문제 발생 시

### SSH 접속 안 됨
- 보안 그룹에서 SSH(22) 포트 확인
- 키 파일 경로 확인
- Elastic IP 확인

### 웹사이트 안 열림
- 보안 그룹에서 HTTP(80) 포트 확인
- Nginx 상태: `sudo systemctl status nginx`
- Gunicorn 상태: `sudo systemctl status gunicorn`

### 502 Bad Gateway
```bash
sudo systemctl restart gunicorn
sudo systemctl restart nginx
```

---

## 📝 명령어 요약

```bash
# SSH 접속
ssh -i pumpy-key.pem ubuntu@YOUR_IP

# 서비스 상태 확인
sudo systemctl status gunicorn
sudo systemctl status nginx
pm2 status

# 서비스 재시작
sudo systemctl restart gunicorn
pm2 restart pumpy-web

# 로그 확인
sudo journalctl -u gunicorn -f
pm2 logs pumpy-web
```

---

## 🎯 체크리스트

GitHub 설정:
- [ ] GitHub 저장소 생성
- [ ] 로컬 코드 푸시

AWS EC2 설정:
- [ ] EC2 인스턴스 생성 (t2.micro)
- [ ] 보안 그룹 설정 (22, 80, 443, 8000)
- [ ] Elastic IP 할당
- [ ] SSH 접속 확인

배포:
- [ ] Git clone
- [ ] 자동 배포 스크립트 실행
- [ ] 관리자 계정 생성
- [ ] 웹사이트 접속 테스트

앱:
- [ ] API URL 변경
- [ ] APK 재빌드
- [ ] 앱 테스트

---

## 🎊 축하합니다!

AWS 무료 프리티어로 12개월 동안 무료로 서비스를 운영하세요! 💪🚀✨

---

작성일: 2025-10-15
AWS 프리티어: 12개월 무료
예상 소요 시간: 40분


