# 🚀 펌피(Pumpy) 배포 및 APK 빌드 가이드

## 📋 현재 상태

### ✅ 완료된 작업
- [x] 로컬 환경 서버 실행 (Django + Next.js)
- [x] Django 백엔드 의존성 수정 (jazzmin 설치)
- [x] API URL AWS 서버로 고정 (3.27.28.175:8000)
- [x] AWS 배포 스크립트 작성
- [x] APK 빌드 스크립트 작성

---

## 🌐 1단계: AWS 서버에 최신 코드 배포

### Windows (PowerShell) 사용자

```powershell
.\deploy_to_aws_full.ps1
```

### Linux/Mac 사용자

```bash
chmod +x deploy_to_aws_full.sh
./deploy_to_aws_full.sh
```

### 배포 내용
1. 백엔드 (Django) 코드 업로드
   - members 앱 (모델, 뷰, 시리얼라이저)
   - 설정 파일
   - requirements.txt

2. 프론트엔드 (Next.js) 코드 업로드
   - app 디렉토리 (모든 페이지)
   - API 설정 파일

3. 서버 재시작
   - Gunicorn (백엔드)
   - PM2 (프론트엔드)

---

## 📱 2단계: APK 빌드

### 자동 빌드 (추천)

```powershell
.\BUILD_APK.ps1
```

이 스크립트는 자동으로:
1. API URL 확인 (AWS 서버 설정 확인)
2. Node 모듈 설치 확인
3. 이전 빌드 정리
4. Release APK 빌드
5. 빌드된 APK를 루트 폴더로 복사

### 수동 빌드

```powershell
cd PumpyApp\android
.\gradlew.bat clean
.\gradlew.bat assembleRelease
```

빌드된 APK 위치:
```
PumpyApp\android\app\build\outputs\apk\release\app-release.apk
```

---

## 🎯 3단계: 결과 확인

### AWS 웹 접속
- **웹 (PC)**: http://3.27.28.175:3000
- **앱 페이지**: http://3.27.28.175:3000/app
- **관리자 페이지**: http://3.27.28.175:8000/admin

### APK 설치
1. `Pumpy_v2.2_Latest.apk` 파일을 스마트폰으로 전송
2. 파일 탭하여 설치
3. "출처를 알 수 없는 앱" 설치 허용
4. 앱 실행 및 로그인

---

## 🔍 API URL 설정 확인

### PumpyApp (React Native)
파일: `PumpyApp/src/utils/api.ts`
```typescript
export const getApiUrl = async (): Promise<string> => {
  console.log('Using AWS Server URL: http://3.27.28.175:8000/api');
  return 'http://3.27.28.175:8000/api';
};
```
✅ AWS 서버로 이미 설정됨

### gym_web (Next.js)
파일: `gym_web/lib/api.ts`
```typescript
const AWS_API_URL = 'http://3.27.28.175:8000/api'

export const getApiUrl = (): string => {
  return AWS_API_URL
}
```
✅ AWS 서버로 이미 설정됨

---

## 📊 현재 시스템 구조

```
┌─────────────────────────────────────────┐
│         AWS 서버 (3.27.28.175)          │
│  ┌──────────────┐    ┌──────────────┐   │
│  │   Django     │    │   Next.js    │   │
│  │  (포트 8000) │    │  (포트 3000) │   │
│  │   /api/*     │    │   웹 UI      │   │
│  │   /admin     │    │              │   │
│  └──────────────┘    └──────────────┘   │
└─────────────────────────────────────────┘
                │
                │ HTTP 통신
                ▼
┌─────────────────────────────────────────┐
│          모바일 앱 (APK)                 │
│  ┌──────────────────────────────────┐   │
│  │      React Native App            │   │
│  │   API: http://3.27.28.175:8000   │   │
│  │   - 로그인/회원가입              │   │
│  │   - 홈 (AI 캐릭터, 출석 통계)    │   │
│  │   - 커뮤니티                     │   │
│  │   - 프로필                       │   │
│  └──────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

---

## 🔧 주요 개발 내용 (로컬 → AWS 반영)

### HomeScreen 주요 기능
1. **AI 캐릭터 이미지**
   - 사용자별 AI 생성 이미지 표시
   - 기본 아바타 → 요가 이미지 등

2. **출석 통계**
   - 연속 출석일 계산
   - 이번 달 출석 횟수
   - 총 출석 횟수

3. **신체 정보**
   - 체중: 70kg
   - 근육량: 35kg
   - 체지방: 15kg

4. **WOD (Workout of the Day)**
   - 오늘의 운동 프로그램

5. **운동 기록**
   - 운동 완료 내역
   - 운동별 세부 정보

6. **자동 새로고침**
   - 30초마다 데이터 자동 갱신

---

## 🚨 문제 해결

### AWS 배포 중 오류 발생 시

1. **SSH 접속 확인**
```bash
ssh ubuntu@3.27.28.175
```

2. **서버 상태 확인**
```bash
# 백엔드
sudo systemctl status gunicorn

# 프론트엔드
pm2 status

# Nginx
sudo systemctl status nginx
```

3. **로그 확인**
```bash
# Gunicorn 로그
sudo journalctl -u gunicorn -f

# PM2 로그
pm2 logs gym_web

# Nginx 로그
sudo tail -f /var/log/nginx/error.log
```

### APK 빌드 오류 시

1. **Gradle 캐시 정리**
```powershell
cd PumpyApp\android
.\gradlew.bat clean
```

2. **Node 모듈 재설치**
```powershell
cd PumpyApp
Remove-Item -Recurse -Force node_modules
npm install
```

3. **Android SDK 확인**
- Android Studio 설치 확인
- SDK 경로 설정 확인
- Java JDK 11 이상 설치

---

## 📞 접속 정보 요약

### 웹 (PC/모바일 브라우저)
- **메인**: http://3.27.28.175:3000
- **앱 UI**: http://3.27.28.175:3000/app
- **관리자**: http://3.27.28.175:8000/admin

### 앱 (APK)
- **파일**: `Pumpy_v2.2_Latest.apk`
- **API**: 자동으로 AWS 서버 연결
- **버전**: 2.2

### 로컬 개발
- **백엔드**: http://localhost:8000
- **프론트엔드**: http://localhost:3000

---

## ✨ 다음 단계

1. [ ] AWS 배포 실행
2. [ ] 웹에서 기능 테스트
3. [ ] APK 빌드 실행
4. [ ] APK 설치 및 테스트
5. [ ] 문제 발생 시 로그 확인 및 수정

---

생성 일시: 2025-10-16
버전: 2.2









