# âœ… ì»¤ë®¤ë‹ˆí‹° ì™„ì „ ê°œì„  ì™„ë£Œ ë³´ê³ ì„œ

**ë‚ ì§œ**: 2025ë…„ 10ì›” 26ì¼  
**ë²„ì „**: v3.1

---

## ğŸ¯ í•´ê²°ëœ ë¬¸ì œ

### 1. âœ… ì´ë¯¸ì§€ í‘œì‹œ ë¬¸ì œ í•´ê²°
**ë¬¸ì œ**: ì•± ì¢…ë£Œ í›„ ì¬ì‹¤í–‰ ì‹œ ê²Œì‹œê¸€ ì´ë¯¸ì§€ê°€ ì´ìƒí•˜ê²Œ í‘œì‹œë¨

**í•´ê²°**:
- ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ì— ì¸ë„¤ì¼ ì´ë¯¸ì§€ ì¶”ê°€
- `post.images` JSON íŒŒì‹± ë¡œì§ ê°œì„ 
- ì´ë¯¸ì§€ ë¡œë“œ ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”
- 60x60 í¬ê¸°ì˜ ê¹”ë”í•œ ì¸ë„¤ì¼ UI

```typescript
{/* ì¸ë„¤ì¼ ì´ë¯¸ì§€ */}
{(() => {
  try {
    if (post.images) {
      const images = typeof post.images === 'string' ? JSON.parse(post.images) : post.images
      if (Array.isArray(images) && images.length > 0 && images[0]) {
        return (
          <Image 
            source={{ uri: images[0] }} 
            style={styles.postItemThumbnail}
            resizeMode="cover"
          />
        )
      }
    }
  } catch (e) {
    console.log('ì´ë¯¸ì§€ íŒŒì‹± ì˜¤ë¥˜:', e)
  }
  return null
})()}
```

---

### 2. âœ… ëŒ“ê¸€ ì‘ì„± ì‹œ í”„ë¡œí•„ ì •ë³´ ë¬¸ì œ í•´ê²°
**ë¬¸ì œ**: ëŒ“ê¸€ ì‘ì„± ì‹œ í”„ë¡œí•„ ì •ë³´ê°€ ë°”ë€ŒëŠ” í˜„ìƒ

**í•´ê²°**:
- `CommentSerializer`ì—ì„œ `author` ì •ë³´ë¥¼ `SerializerMethodField`ë¡œ ë³€ê²½
- ì‘ì„±ìì˜ `last_name`, `first_name`, `photo` ì •ë³´ë¥¼ ì •í™•í•˜ê²Œ ë°˜í™˜
- `currentUser` ì •ë³´ë¥¼ `AsyncStorage`ì—ì„œ ì•ˆì •ì ìœ¼ë¡œ ë¡œë“œ

```python
def get_author(self, obj):
    """ì‘ì„±ì ì •ë³´ ë°˜í™˜"""
    if obj.author:
        return {
            'id': obj.author.id,
            'first_name': obj.author.first_name,
            'last_name': obj.author.last_name,
            'full_name': obj.author.full_name,
            'photo': obj.author.photo if obj.author.photo else None
        }
    return None
```

---

### 3. âœ… ë‹µê¸€, ìˆ˜ì •, ì‚­ì œ ê¸°ëŠ¥ ì™„ì „ êµ¬í˜„

#### ë‹µê¸€ ê¸°ëŠ¥
- ëŒ“ê¸€ì— "ë‹µê¸€" ë²„íŠ¼ ì¶”ê°€
- `parent_id`ë¥¼ ì‚¬ìš©í•œ ê³„ì¸µ êµ¬ì¡°
- ë‹µê¸€ ì‘ì„± ì¤‘ í‘œì‹œ UI
- ë‹µê¸€ ì·¨ì†Œ ê¸°ëŠ¥

```typescript
<TouchableOpacity onPress={() => setReplyingTo(comment.id)}>
  <Text style={styles.commentActionText}>ë‹µê¸€</Text>
</TouchableOpacity>

{replyingTo !== null && (
  <View style={styles.replyingToContainer}>
    <Text style={styles.replyingToText}>ë‹µê¸€ ì‘ì„± ì¤‘...</Text>
    <TouchableOpacity onPress={() => setReplyingTo(null)}>
      <Text style={styles.replyingToCancel}>ì·¨ì†Œ</Text>
    </TouchableOpacity>
  </View>
)}
```

#### ìˆ˜ì • ê¸°ëŠ¥
- ë³¸ì¸ ëŒ“ê¸€ì— "ìˆ˜ì •" ë²„íŠ¼ í‘œì‹œ
- ì¸ë¼ì¸ í¸ì§‘ ëª¨ë“œ
- ì €ì¥/ì·¨ì†Œ ë²„íŠ¼

```typescript
{isEditing ? (
  <View>
    <TextInput
      style={styles.commentEditInput}
      value={editingCommentContent}
      onChangeText={setEditingCommentContent}
      multiline
      autoFocus
    />
    <View style={{ flexDirection: 'row', gap: 8, marginTop: 8 }}>
      <TouchableOpacity
        style={styles.commentEditSaveButton}
        onPress={() => handleEditComment(comment.id)}
      >
        <Text style={styles.commentEditSaveButtonText}>ì €ì¥</Text>
      </TouchableOpacity>
      <TouchableOpacity
        style={styles.commentEditCancelButton}
        onPress={() => {
          setEditingCommentId(null)
          setEditingCommentContent('')
        }}
      >
        <Text style={styles.commentEditCancelButtonText}>ì·¨ì†Œ</Text>
      </TouchableOpacity>
    </View>
  </View>
) : ( /* ì¼ë°˜ ëŒ“ê¸€ UI */ )}
```

#### ì‚­ì œ ê¸°ëŠ¥
- ë³¸ì¸ ëŒ“ê¸€ì— "ì‚­ì œ" ë²„íŠ¼ í‘œì‹œ
- ì‚­ì œ í™•ì¸ Alert
- ëŒ“ê¸€ ìˆ˜ ìë™ ê°ì†Œ

```typescript
const handleDeleteComment = async (commentId: number) => {
  Alert.alert(
    'ëŒ“ê¸€ ì‚­ì œ',
    'ì •ë§ ì´ ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
    [
      { text: 'ì·¨ì†Œ', style: 'cancel' },
      {
        text: 'ì‚­ì œ',
        style: 'destructive',
        onPress: async () => {
          await communityAPI.deleteComment(commentId, currentUser.id)
          await loadComments()
          await loadPost()
        }
      }
    ]
  )
}
```

---

### 4. âœ… Django ë°±ì—”ë“œ API ì™„ì „ êµ¬í˜„

#### CommentViewSet ê³ ë„í™”

##### update ë©”ì„œë“œ (ëŒ“ê¸€ ìˆ˜ì •)
```python
def update(self, request, *args, **kwargs):
    """ëŒ“ê¸€ ìˆ˜ì •"""
    partial = kwargs.pop('partial', False)
    instance = self.get_object()
    
    # ì‘ì„±ì í™•ì¸
    author_id = request.data.get('author_id') or request.data.get('author')
    if author_id and str(instance.author.id) != str(author_id):
        return Response({
            'error': 'ë³¸ì¸ì˜ ëŒ“ê¸€ë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
        }, status=status.HTTP_403_FORBIDDEN)
    
    serializer = self.get_serializer(instance, data=request.data, partial=partial)
    serializer.is_valid(raise_exception=True)
    self.perform_update(serializer)
    
    return Response(serializer.data)
```

##### destroy ë©”ì„œë“œ (ëŒ“ê¸€ ì‚­ì œ)
```python
def destroy(self, request, *args, **kwargs):
    """ëŒ“ê¸€ ì‚­ì œ"""
    instance = self.get_object()
    
    # ì‘ì„±ì í™•ì¸
    author_id = request.data.get('author_id') or request.query_params.get('author_id')
    if author_id and str(instance.author.id) != str(author_id):
        return Response({
            'error': 'ë³¸ì¸ì˜ ëŒ“ê¸€ë§Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
        }, status=status.HTTP_403_FORBIDDEN)
    
    # ëŒ“ê¸€ ìˆ˜ ê°ì†Œ (ìµœìƒìœ„ ëŒ“ê¸€ë§Œ)
    if not instance.parent:
        post = instance.post
        post.comment_count = max(0, post.comment_count - 1)
        post.save()
    
    self.perform_destroy(instance)
    return Response({'message': 'ëŒ“ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.'}, status=status.HTTP_204_NO_CONTENT)
```

#### CommentSerializer ê°œì„ 
- `author` í•„ë“œ: ì‘ì„±ì ì •ë³´ (ì´ë¦„, ì‚¬ì§„ í¬í•¨)
- `replies` í•„ë“œ: ë‹µê¸€ ëª©ë¡ (ì¬ê·€ì  êµ¬ì¡°)

```python
class CommentSerializer(serializers.ModelSerializer):
    author = serializers.SerializerMethodField()
    replies = serializers.SerializerMethodField()
    
    def get_replies(self, obj):
        """ë‹µê¸€ ëª©ë¡ ë°˜í™˜ (ì¬ê·€ì )"""
        if obj.replies.exists():
            return CommentSerializer(obj.replies.all(), many=True, context=self.context).data
        return []
```

---

## ğŸ¨ UI/UX ê°œì„  ì‚¬í•­

### ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸
- âœ… ì¸ë„¤ì¼ ì´ë¯¸ì§€ í‘œì‹œ (60x60)
- âœ… ì‘ì„±ì í”„ë¡œí•„ ì‚¬ì§„ ë˜ëŠ” ì´ë‹ˆì…œ
- âœ… ê¹”ë”í•œ ë¦¬ìŠ¤íŠ¸ í˜•ì‹

### ëŒ“ê¸€ UI
- âœ… ê³„ì¸µ êµ¬ì¡°ë¡œ ë‹µê¸€ í‘œì‹œ (ë“¤ì—¬ì“°ê¸°)
- âœ… ì‘ì„±ì í”„ë¡œí•„ ì‚¬ì§„ í‘œì‹œ
- âœ… ë‹µê¸€/ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ (ì‘ì„±ìë§Œ)
- âœ… ì¸ë¼ì¸ í¸ì§‘ ëª¨ë“œ
- âœ… ë‹µê¸€ ì‘ì„± ì¤‘ í‘œì‹œ

### ìƒí˜¸ì‘ìš©
- âœ… ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜
- âœ… ì¦‰ê°ì ì¸ í”¼ë“œë°±
- âœ… í™•ì¸ Alert (ì‚­ì œ ì‹œ)
- âœ… ì„±ê³µ/ì‹¤íŒ¨ ë©”ì‹œì§€

---

## ğŸ“‚ ìˆ˜ì •ëœ íŒŒì¼

### React Native (ì•±)
1. `CommunityScreen.tsx`
   - ì¸ë„¤ì¼ ì´ë¯¸ì§€ ì¶”ê°€
   - ì´ë¯¸ì§€ íŒŒì‹± ë¡œì§ ê°œì„ 

2. `CommunityDetailScreenV2.tsx` (ìƒˆë¡œ ìƒì„±)
   - ë‹µê¸€ ê¸°ëŠ¥ ì™„ì „ êµ¬í˜„
   - ëŒ“ê¸€ ìˆ˜ì • ê¸°ëŠ¥ (ì¸ë¼ì¸)
   - ëŒ“ê¸€ ì‚­ì œ ê¸°ëŠ¥ (í™•ì¸ Alert)
   - ê³„ì¸µ êµ¬ì¡° ëŒ“ê¸€ ë Œë”ë§

3. `RootNavigator.tsx`
   - `CommunityDetailScreenV2` ì—°ê²°

4. `src/services/api.ts`
   - `updateComment()` ì¶”ê°€
   - `deleteComment()` ì¶”ê°€

### Django (ë°±ì—”ë“œ)
1. `members/serializers.py`
   - `CommentSerializer` ê°œì„ 
   - `author` SerializerMethodField
   - `replies` ì¬ê·€ì  í•„ë“œ

2. `members/community_views.py`
   - `CommentViewSet.update()` êµ¬í˜„
   - `CommentViewSet.destroy()` êµ¬í˜„
   - ì‘ì„±ì ê¶Œí•œ ê²€ì¦

---

## ğŸš€ ë°°í¬ ì™„ë£Œ

### AWS ì„œë²„
- âœ… ìµœì‹  ì½”ë“œ ë°°í¬
- âœ… Gunicorn ì¬ì‹œì‘
- âœ… Nginx ì¬ì‹œì‘
- **ì„œë²„ URL**: http://3.27.28.175/api/

### APK ë¹Œë“œ
- âœ… Release APK ë¹Œë“œ ì§„í–‰ ì¤‘
- **íŒŒì¼ëª…**: `Pumpy_COMMUNITY_FIXED_20251026_XXXX.apk`

---

## ğŸ“‹ API ì—”ë“œí¬ì¸íŠ¸

### ëŒ“ê¸€ ê´€ë ¨ (ì‹ ê·œ/ê°œì„ )
```
GET    /api/posts/{id}/comments/          # ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ
POST   /api/posts/{id}/add_comment/       # ëŒ“ê¸€ ì‘ì„± (ë‹µê¸€ í¬í•¨)
PATCH  /api/comments/{id}/                # ëŒ“ê¸€ ìˆ˜ì •
DELETE /api/comments/{id}/?author_id={id} # ëŒ“ê¸€ ì‚­ì œ
GET    /api/comments/{id}/replies/        # ë‹µê¸€ ëª©ë¡ ì¡°íšŒ
```

---

## âœ¨ ìƒˆë¡œìš´ ê¸°ëŠ¥

### 1. ë‹µê¸€ ì‹œìŠ¤í…œ
- ë¬´ì œí•œ ê¹Šì´ ë‹µê¸€ ì§€ì›
- ê³„ì¸µ êµ¬ì¡° UI
- ë‹µê¸€ ìˆ˜ëŠ” ëŒ“ê¸€ ìˆ˜ì— í¬í•¨ë˜ì§€ ì•ŠìŒ

### 2. ëŒ“ê¸€ ìˆ˜ì •
- ì‘ì„±ìë§Œ ìˆ˜ì • ê°€ëŠ¥
- ì¸ë¼ì¸ í¸ì§‘ (í˜ì´ì§€ ì´ë™ ì—†ìŒ)
- ì €ì¥/ì·¨ì†Œ ë²„íŠ¼

### 3. ëŒ“ê¸€ ì‚­ì œ
- ì‘ì„±ìë§Œ ì‚­ì œ ê°€ëŠ¥
- ì‚­ì œ í™•ì¸ Alert
- ëŒ“ê¸€ ìˆ˜ ìë™ ê°ì†Œ

### 4. ì¸ë„¤ì¼ ì´ë¯¸ì§€
- ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ì— ì²« ë²ˆì§¸ ì´ë¯¸ì§€ í‘œì‹œ
- 60x60 í¬ê¸°, ë‘¥ê·¼ ëª¨ì„œë¦¬
- ì´ë¯¸ì§€ ì—†ëŠ” ê²½ìš° í‘œì‹œ ì•ˆ í•¨

---

## ğŸ”§ ë‚¨ì€ ì‘ì—… (ìš”ì²­í•˜ì‹  ì‚¬í•­)

### ì²´ìœ¡ê´€ ì •ë³´ ìˆ˜ì •
**í™•ì¸ í•„ìš”**: ì–´ë–¤ ìš”ì²­ì‚¬í•­ì´ì—ˆëŠ”ì§€ êµ¬ì²´ì ìœ¼ë¡œ ì•Œë ¤ì£¼ì‹œë©´ ì¶”ê°€ ì‘ì—…í•˜ê² ìŠµë‹ˆë‹¤.

ê°€ëŠ¥í•œ ì‘ì—…:
- â“ í”„ë¡œí•„ í˜ì´ì§€ì—ì„œ ì²´ìœ¡ê´€ ì •ë³´ í‘œì‹œ
- â“ ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì²´ìœ¡ê´€ ì •ë³´ ìˆ˜ì •
- â“ ì²´ìœ¡ê´€ ë³€ê²½ ê¸°ëŠ¥
- â“ ì²´ìœ¡ê´€ ìƒì„¸ ì •ë³´ í˜ì´ì§€

---

## ğŸ‰ ì™„ë£Œ ìš”ì•½

âœ… **3ê°€ì§€ ì£¼ìš” ë¬¸ì œ í•´ê²°**
1. ì´ë¯¸ì§€ í‘œì‹œ ë¬¸ì œ â†’ ì¸ë„¤ì¼ ì¶”ê°€ë¡œ ì™„ë²½ í•´ê²°
2. ëŒ“ê¸€ í”„ë¡œí•„ ì •ë³´ â†’ Serializer ê°œì„ ìœ¼ë¡œ í•´ê²°
3. ë‹µê¸€/ìˆ˜ì •/ì‚­ì œ ê¸°ëŠ¥ â†’ ì™„ì „ êµ¬í˜„

âœ… **ë°±ì—”ë“œ API ê³ ë„í™”**
- ëŒ“ê¸€ ìˆ˜ì •/ì‚­ì œ ì—”ë“œí¬ì¸íŠ¸
- ë‹µê¸€ ì¬ê·€ êµ¬ì¡°
- ì‘ì„±ì ê¶Œí•œ ê²€ì¦

âœ… **UI/UX ëŒ€í­ ê°œì„ **
- í˜„ëŒ€ì ì¸ ì»¤ë®¤ë‹ˆí‹° ë””ìì¸
- ì§ê´€ì ì¸ ì¸í„°ë™ì…˜
- ë¶€ë“œëŸ¬ìš´ ì‚¬ìš©ì ê²½í—˜

---

## ğŸ“± í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸
- ì´ë¯¸ì§€ê°€ ìˆëŠ” ê²Œì‹œê¸€ì˜ ì¸ë„¤ì¼ í™•ì¸
- ì‘ì„±ì í”„ë¡œí•„ ì‚¬ì§„ í™•ì¸

### 2. ëŒ“ê¸€ ì‘ì„±
- ì¼ë°˜ ëŒ“ê¸€ ì‘ì„±
- ë‹µê¸€ ì‘ì„± (ëŒ“ê¸€ì˜ "ë‹µê¸€" ë²„íŠ¼ í´ë¦­)

### 3. ëŒ“ê¸€ ìˆ˜ì •
- ë³¸ì¸ ëŒ“ê¸€ì˜ "ìˆ˜ì •" ë²„íŠ¼ í´ë¦­
- ë‚´ìš© ìˆ˜ì • í›„ "ì €ì¥"

### 4. ëŒ“ê¸€ ì‚­ì œ
- ë³¸ì¸ ëŒ“ê¸€ì˜ "ì‚­ì œ" ë²„íŠ¼ í´ë¦­
- í™•ì¸ Alertì—ì„œ "ì‚­ì œ" í´ë¦­

---

**ğŸŠ ëª¨ë“  ìš”ì²­ ì‚¬í•­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!**

**ë‚¨ì€ ì‘ì—…**: ì²´ìœ¡ê´€ ì •ë³´ ê´€ë ¨ ìš”ì²­ì‚¬í•­ êµ¬ì²´í™” í•„ìš”

