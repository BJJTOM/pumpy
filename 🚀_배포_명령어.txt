━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🚀 AWS 배포 명령어 (복사해서 사용!)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 인스턴스 연결성 검사 통과!
✅ 이제 배포 준비 완료!

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
방법 1: Session Manager (추천!)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. AWS 콘솔에서 인스턴스 선택
2. "연결" 버튼 클릭
3. "Session Manager" 탭 선택
4. "연결" 클릭
5. 다음 명령어 복사 & 붙여넣기:

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 배포 명령어 (한 줄로!)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

cd ~/pumpy && git pull origin main && cd gym_api && source venv/bin/activate && pip install -r requirements.txt && python manage.py makemigrations && python manage.py migrate && python manage.py collectstatic --noinput && sudo systemctl restart gunicorn && cd ../gym_web && npm install --prefer-offline --no-audit && npm run build && pm2 restart gym-web 2>/dev/null || pm2 start npm --name gym-web -- start && pm2 save && sudo systemctl restart nginx && echo "✅ 배포 완료!"

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 배포 명령어 (단계별 - 디버깅용)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# 1. 프로젝트 디렉토리로 이동 및 업데이트
cd ~/pumpy
git pull origin main

# 2. Django 백엔드 배포
cd gym_api
source venv/bin/activate
pip install -r requirements.txt
python manage.py makemigrations
python manage.py migrate
python manage.py collectstatic --noinput
sudo systemctl restart gunicorn

# 3. Next.js 프론트엔드 배포
cd ../gym_web
npm install --prefer-offline --no-audit
npm run build
pm2 restart gym-web || pm2 start npm --name gym-web -- start
pm2 save

# 4. Nginx 재시작
sudo systemctl restart nginx

# 5. 상태 확인
sudo systemctl status gunicorn --no-pager
pm2 status
sudo systemctl status nginx --no-pager

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⏱️ 예상 시간
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

- Git Pull: 10초
- 백엔드 배포: 1-2분
- 프론트엔드 빌드: 5-8분
- Nginx 재시작: 5초

총 예상 시간: 7-10분

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 완료 확인
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. 웹 브라우저에서 접속:
   🌐 http://3.27.28.175

2. 회원 앱 접속:
   📱 http://3.27.28.175/app

3. 관리자 페이지:
   🔐 http://3.27.28.175/admin

4. APK 재실행:
   📱 앱 종료 후 재실행 → 정상 작동!

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔧 문제 해결
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

빌드가 실패하면:

# Next.js 캐시 삭제 후 재빌드
cd ~/pumpy/gym_web
rm -rf .next node_modules/.cache
npm run build

# PM2 프로세스 완전 삭제 후 재시작
pm2 delete gym-web
pm2 start npm --name gym-web -- start
pm2 save

# Gunicorn 로그 확인
sudo journalctl -u gunicorn -n 50 --no-pager

# Nginx 로그 확인
sudo tail -n 50 /var/log/nginx/error.log

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
방법 2: SSH로 배포 (대안)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

PowerShell에서 다음 명령어 실행:

ssh -i "C:\Users\guddn\Downloads\COCO\pumpy-key.pem" ubuntu@3.27.28.175 "cd ~/pumpy && git pull origin main && cd gym_api && source venv/bin/activate && pip install -r requirements.txt && python manage.py migrate && sudo systemctl restart gunicorn && cd ../gym_web && npm install && npm run build && pm2 restart gym-web && sudo systemctl restart nginx"

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 배포 완료 체크리스트
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

- [ ] Git pull 완료
- [ ] Django 마이그레이션 완료
- [ ] Gunicorn 재시작 완료
- [ ] Next.js 빌드 완료
- [ ] PM2 시작 완료
- [ ] Nginx 재시작 완료
- [ ] 웹 접속 확인
- [ ] APK 작동 확인

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

작성: 2025-10-25
목적: AWS 서버 배포
예상 시간: 7-10분

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

